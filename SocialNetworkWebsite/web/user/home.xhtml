<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <title>User's Home Page</title>
    </h:head>
    <h:body>


        <p:layout fullPage="true">
            <p:layoutUnit position="north">
                <h:form>
                    <h:link outcome="home.xhtml">Home</h:link>
                    &nbsp;
                    <h:inputText id="search" value="#{searchController.keyword}"/>
                    <p:watermark for="search" value="Search for people" />

                    <h:commandButton id="searchSubmit" value="Search" action="#{searchController.doSearch()}"/>
                    &nbsp;
                    <p:menuButton value="Options">
                        <p:menuitem value="Log out" action="#{userController.logout()}"/>
                        <p:menuitem value="Delete"/>
                    </p:menuButton>
                </h:form>
            </p:layoutUnit>

            <p:layoutUnit position="west" header="#{userController.user.screenName}" size="250">
                <p:graphicImage value="#{userController.profileImage}"  height="200" width="200"/>
                <br/>
                <h:link outcome="myProfile.xhtml">Edit Profile</h:link>
            </p:layoutUnit>

            <p:layoutUnit position="center" header="Wall">
                <h:form id="superForm">
                    <p:growl id="growl" showDetail="true" life="2000"/>
                    <p:inputTextarea id="postText" rows="4" cols="50"  value ="#{feedController.newFeed.text}"/>
                    <br/>
                    <p:commandButton id="imageAdder" value="Add an image" icon="ui-icon-edit"
                                     type="button" onclick="imageOP.show();"/>
                    <p:commandButton id="submitPost" value="Post" 
                                     action="#{feedController.post()}" update="@form"/>
                    <p:scrollPanel id="scroll">
                        <p:dataGrid id="feedList" var="feed" value="#{wallController.getWalls()}" columns='1' rows='10'
                                    paginator="true" paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                    rowsPerPageTemplate="10,15,20" lazy="true">
                            <p:fieldset legend="#{feed.time.toLocaleString()}">
                                <h:panelGrid>
                                    <p:row>
                                        <p:column rowspan="2">
                                            <p:graphicImage value="#{imageController.profileImage}" height="50" width="50">
                                                <f:param name="id" value="#{feed.poster.id}"/>
                                            </p:graphicImage> 
                                        </p:column>
                                        <p:column>
                                            <h:outputText value="#{feed.poster.screenName} says:" />

                                        </p:column>
                                    </p:row>
                                    <p:row>
                                        <h:outputText value="#{feed.text}"/>
                                    </p:row>
                                    <p:row>
                                        <p:graphicImage value="#{imageController.wallImage}" rendered="#{feed.hasImage()}">
                                            <f:param name="feedId" value="#{feed.id}"/>
                                        </p:graphicImage> 
                                    </p:row>
                                </h:panelGrid>
                            </p:fieldset>
                        </p:dataGrid>
                    </p:scrollPanel>
                </h:form>


            </p:layoutUnit>

            <p:layoutUnit position="east" header="Friends" size="250">
                <p:dataTable var="person" value="#{friendsController.users}" >
                <p:column>
                    <p:graphicImage value="#{imageController.profileImage}" height="40" width="40">
                        <f:param name="id" value="#{person.friend.id}"/>
                    </p:graphicImage>
                    </p:column>
                <p:column >
                    <h:outputText value="#{person.friend.screenName}"/>
                </p:column>
                
            </p:dataTable> 
            </p:layoutUnit>
        </p:layout>

        <p:growl id="messages" showDetail="true" life="2000"/>
        <p:dialog id="imageEditorPanel" widgetVar="imageOP" header="image size less than 1MB">
            <h:form enctype="multipart/form-data">  
                <p:fileUpload fileUploadListener="#{feedController.addImage}"
                              mode="advanced"  
                              update="@form :messages"  
                              auto="false"  
                              sizeLimit="1000000"   
                              allowTypes="/(\.|\/)(jpe?g|png)$/"
                              oncomplete="imageOP.hide();"/>  
            </h:form>
        </p:dialog>
    </h:body>
</html>

